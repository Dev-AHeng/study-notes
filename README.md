# Openfire + smack

### 前言

出于对 markdown 文件的编写练手，结合最近的兴趣工程 smack+openfire 的 xmpp 协议即时聊天。接下来文章将会涉及关于 openfire 安装(Linux 平台)、基础设置、卸载，smack 包导入及基本 api 的使用。

-------

## openfire 部分

### 1. 介绍

您可以使用 openfire 轻易的构建高效率的即时通信服务器

Openfire 安装和使用都非常简单，并利用 Web 进行管理。单台服务器可支持上万并发用户

由于是采用开放的 `XMPP` 协议，您可以使用各种支持 XMPP 协议的 IM 客户端软件登陆服务

-------

### 2. 准备
1. 一台 centos 系统的服务器，建议版本是 7.x 或 8.x 的
2. 一台电脑，用于下载 openfire 安装包并上传到服务器
3. 用电脑下载 [openfire 安装包(Linux 版带 java 运行环境的)](https://www.igniterealtime.org/downloads/index.jsp)，我下载的是目前最新 Linux 版的 openfire4.5.1 (注：访问不了或下载慢请自行搭梯)
4. 下载完成后，在电脑点击：开始->搜索->输入 powershell 并打开
5. 用 `cd 下载openfire的文件夹路径`，例如：`cd C:\\Users\\Administrator\\Desktop\\Linuxopenfire` 
6. 然后 `ls` 命令列出当前目录文件
7. 最后用 `scp .\\openfire安装包 账户@地址:目的路径` 命令把文件传输到服务器。例如：`scp .\openfire-4.5.1-1.x86_64  root@120.78.209.130:/root/openfire` ，按回车输入密码即可传输 openfire 安装包传到服务器的 `/root/openfire/` 目录

-------

### 3. 安装等其它操作

直接敲 `rpm -ivh openfire-4.5.1-1.x86_64.rpm`，会默认安装到 `/opt/openfire` ，等待安装完毕

```bash
# 一些操作：

# 1.添加开机启动
systemctl enable openfire

# 2.启动
systemctl start opefire
# 或者
/etc/init.d/openfire start

# 3.停止
systemctl stop opefire
# 或者
/etc/init.d/openfire stop

# 4.查询状态
systemctl status openfire
# 或者
/etc/init.d/openfire status
```

-------

### 4. 测试

###### 需要开启一下端口：

| 接口 | 端口 | 类型 | 描述 |
|:----------:|:----------:|:----------:|:----------:|
| 所有的地址 | 5222 | 客户端到服务器 | 端口用于客户端以标准方式连接到服务器。 此端口使用纯文本方式建立连接，取决于安全设置的配置，可以（或必须）升级到加密连接。 |
| 所有的地址 | 5223 | 客户端到服务器 | 端口用于客户端以旧式 SSL/TLS 方式连接到服务器。 此端口使用预加密方式建立连接，这种连接类型通常被称为“旧式”或“传统”模式。可以在安全设置中修改配置细节。 |
| 所有的地址 | 7070 | HTTP 绑定 | 端口用于客户端使用不安全的 HTTP 方式访问 |
| 所有的地址 | 7443 | HTTP 绑定 | 端口用于客户端使用安全的 HTTP 方式访问 |
| 所有的地址 | 5269 | 远程服务器到服务器 | 端口用于远程服务器以标准方式连接到服务器。 此端口使用纯文本方式建立连接，取决于安全设置的配置，可以（或必须）升级到加密连接。 |
| 所有的地址 | 5270 | 远程服务器到服务器 | 端口用于远程服务器以标准方式连接到服务器。 此端口使用预加密方式建立连接，这种连接类型通常被称为“旧式”或“传统”模式。可以在安全设置中修改配置细节。 |
| 所有的地址 | 5275 | 外部组件 | 端口用于外部组件以标准方式连接到服务器。 此端口使用纯文本方式建立连接，取决于安全设置的配置，可以（或必须）升级到加密连接。 |
| 所有的地址 | 5276 | 外部组件 | 端口用于外部组件以旧式 SSL/TLS 方式连接到服务器。 此端口使用预加密方式建立连接，这种连接类型通常被称为“旧式”或“传统”模式。可以在安全设置中修改配置细节。 |
| 所有的地址 | 5262 | 连接管理器 | 端口用于连接管理器以标准方式连接到服务器。 此端口使用纯文本方式建立连接，取决于安全设置的配置，可以（或必须）升级到加密连接。 |
| 所有的地址 | 5263 | 连接管理器 | 端口用于连接管理器以旧式 SSL/TLS 方式连接到服务器。 此端口使用预加密方式建立连接，这种连接类型通常被称为“旧式”或“传统”模式。可以在安全设置中修改配置细节。 |
| 所有的地址 | 9090 | 管理界面 | 端口用于管理界面以不安全方式访问。 |
| 所有的地址 | 9091 | 管理界面 | 端口用于管理界面以安全方式访问。 |
| 所有的地址 | 7777 | 文件传送代理服务器 | 端口用于代理服务在 XMPP 网络上的两个实体间进行文件传送。 |
| 所有的地址 | 5229 | 跨域访问 | 这个服务允许 Flash 客户端连接到其他服务器主机端口。 |

最后在浏览器输入 `http://你的服务器host:9090`，例如：我的是 `http://120.78.209.130:9090`，即可进入 openfire 的基本配置

-------

### 5. openfire 注意

1. 如果你设置了登录密码，那么账号默认是：`admin`
2. 登录进入 openfire 后，到：服务器->服务器管理器->语言和时间->选择时区->选择(GMT+8:00) 中国夏令时
